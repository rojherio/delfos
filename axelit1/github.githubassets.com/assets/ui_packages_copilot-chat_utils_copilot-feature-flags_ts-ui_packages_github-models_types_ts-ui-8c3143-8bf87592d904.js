"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["ui_packages_copilot-chat_utils_copilot-feature-flags_ts-ui_packages_github-models_types_ts-ui-8c3143"],{2622:(e,t,r)=>{r.d(t,{W:()=>o});var n=r(75632);let o=new class CopilotFeatureFlags{get unstickyReferences(){return(0,n.G7)("copilot_conversational_ux_history_refs")}get customInstructions(){return(0,n.G7)("copilot_chat_custom_instructions")}get immersiveFigmaIntegration(){return(0,n.G7)("copilot_immersive_figma_integration")}get immersiveIssuePreview(){return(0,n.G7)("copilot_immersive_issue_preview")}get createIssueForm(){return(0,n.G7)("copilot_api_create_issue_skill")}get immersiveServiceNavigation(){return this.customCopilots||this.pipesPlugin||this.workbenchPlugin}get copilotChatInterviewSurvey(){return(0,n.G7)("copilot_chat_interview_survey")}get newImmersiveReferencesUI(){return(0,n.G7)("copilot_new_immersive_references_ui")}get repoCustomInstructions(){return(0,n.G7)("copilot_chat_repo_custom_instructions")}get repoCustomInstructionsPreview(){return(0,n.G7)("copilot_chat_repo_custom_instructions_preview")}get attachImagesImmersive(){return(0,n.G7)("copilot_chat_attach_images")}get retryModelPicker(){return(0,n.G7)("copilot_chat_show_model_picker_on_retry")}get customCopilots(){return(0,n.G7)("copilot_custom_copilots")}get shareConversation(){return(0,n.G7)("copilot_share_conversation")}get clientDOMSkills(){return(0,n.G7)("copilot_client_dom_skills")}get dotcomChatClientSideSkills(){return(0,n.G7)("dotcom_chat_client_side_skills")}get taskOrientedAssistive(){return(0,n.G7)("copilot_task_oriented_assistive")}get pipesPlugin(){return(0,n.G7)("copilot_pipes")}get workbenchPlugin(){return(0,n.G7)("copilot_workbench")}get copilotChatOpeningThreadSwitch(){return(0,n.G7)("copilot_chat_opening_thread_switch")}get copilotReadSharedConversation(){return(0,n.G7)("copilot_read_shared_conversation")}get copilotDuplicateThread(){return(0,n.G7)("copilot_duplicate_thread")}get copilotManageSharedConversations(){return(0,n.G7)("copilot_manage_shared_conversations")}get copilotShareActiveSubthread(){return(0,n.G7)("copilot_share_active_subthread")}get copilotUIRefs(){return(0,n.G7)("copilot_ui_refs")}get dotcomChatFileUpload(){return(0,n.G7)("copilot_dotcom_chat_file_upload")&&(0,n.G7)("copilot_chat_attachments")}get bufferStreamingContent(){return(0,n.G7)("copilot_buffered_streaming")}get copilotChatO1Tools(){return(0,n.G7)("copilot_api_tools_for_non_streaming_models")}get topicsAsReferences(){return(0,n.G7)("copilot_topics_as_references")}get bingGroundingServiceEnabled(){return(0,n.G7)("copilot_bing_search_use_azure_ai_agent_service")}get bingGroundingUIEnabled(){return(0,n.G7)("copilot_bing_search_use_grounding_ui")&&this.bingGroundingServiceEnabled}get showDeepCodeSearchButton(){return(0,n.G7)("copilot_show_deep_code_search_button")&&(0,n.G7)("copilot_api_search_agent_skill")}}},76797:(e,t,r)=>{r.d(t,{D:()=>n});function n(e){if("clipboard"in navigator)return navigator.clipboard.writeText(e);let t=document.body;if(!t)return Promise.reject(Error());let r=function(e){let t=document.createElement("pre");return t.style.width="1px",t.style.height="1px",t.style.position="fixed",t.style.top="5px",t.textContent=e,t}(e);return t.appendChild(r),!function(e){if("clipboard"in navigator)return navigator.clipboard.writeText(e.textContent||"");let t=getSelection();if(null==t)return Promise.reject(Error());t.removeAllRanges();let r=document.createRange();r.selectNodeContents(e),t.addRange(r),document.execCommand("copy"),t.removeAllRanges(),Promise.resolve()}(r),t.removeChild(r),Promise.resolve()}},25511:(e,t,r)=>{r.d(t,{G:()=>n});let n={UNKNOWN:0,POSITIVE:1,NEGATIVE:2}},88733:(e,t,r)=>{r.d(t,{TE:()=>a,Th:()=>n.Th,pH:()=>s,rn:()=>i,ut:()=>o});var n=r(697);let o=["user","system","assistant","error","tool","developer"],i="user",a="system",s={PARAMETERS:0,DETAILS:1}},47802:(e,t,r)=>{r.d(t,{Ay:()=>i});var n=r(57572);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let AuthToken=class AuthToken{get authorizationHeaderValue(){return`GitHub-Bearer ${this.token}`}needsRefreshing(){return this.isExpired}get isExpired(){let e=new Date(this.expiration||new Date(0).toISOString());return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))<new Date(Date.now()+15e3)}static fromResult(e){return new AuthToken(e.token,e.expiration)}serialize(){return{token:this.token,expiration:this.expiration}}static deserialize(e){return new AuthToken(e.token,e.expiration)}async getAuthTokenValue(){return localStorage.getItem(this.authTokenLocalStorageOverwriteKey)??(await this.getAuthToken()).authorizationHeaderValue}async getAuthToken(){let e=localStorage.getItem(this.authTokenLocalStorageOverwriteKey);if(e)return new AuthToken(e.replace("Bearer ",""));let t=localStorage.getItem(this.authTokenLocalStorageKey);if(!t)return this.fetchAuthToken();let r=AuthToken.deserialize(JSON.parse(t));return this.validateAuthToken(r)}async validateAuthToken(e){return e.needsRefreshing()?this.fetchAuthToken():e}fetchAuthToken(){return this.currentAuthTokenRequest||(this.currentAuthTokenRequest=this._fetchAuthToken()),this.currentAuthTokenRequest}async _fetchAuthToken(){let e=await (0,n.lS)("/marketplace/models/token",{method:"POST"});if(e.ok){let t=await e.json();this.currentAuthTokenRequest=null;let r=AuthToken.fromResult(t);return localStorage.setItem(this.authTokenLocalStorageKey,JSON.stringify(r.serialize())),r}{this.currentAuthTokenRequest=null;let t=await e.json();if(t.error)throw Error(t.error);throw Error("Failed to mint new auth token")}}constructor(e,t){o(this,"token",void 0),o(this,"expiration",void 0),o(this,"currentAuthTokenRequest",void 0),o(this,"authTokenLocalStorageKey","NEUTRON_AUTH_TOKEN"),o(this,"authTokenLocalStorageOverwriteKey","NEUTRON_AUTH_TOKEN_OVERWRITE"),this.token=e,this.expiration=t,this.currentAuthTokenRequest=null}};let i=new AuthToken},25780:(e,t,r)=>{r.d(t,{o:()=>AzureModelClient});var n=r(80688),o=r(47802),i=r(697);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let s=/^data:\s+/;let MessageStreamer=class MessageStreamer{async *stream(){let e=new TextDecoder("utf-8"),t="";for(;;){let r,n;try{this.resetChunkTimeout(),{value:r,done:n}=await this.reader.read()}catch(e){if(this.abortController?.signal?.aborted)throw this.abortController.signal.reason;throw e}finally{this.clearChunkTimeout()}if(n)break;for(t+=e.decode(r);;){if(t.startsWith("data: [DONE]"))return;let e=t.indexOf("\n\n");if(-1===e)break;let r=t.slice(0,e).replace(s,"");if(""===r){t=t.slice(e+2);continue}let n=JSON.parse(r);yield n,t=t.slice(e+2)}}}async stop(){return this.reader.cancel()}clearChunkTimeout(){this.chunkTimeoutId&&(clearTimeout(this.chunkTimeoutId),this.chunkTimeoutId=void 0)}resetChunkTimeout(){this.abortController&&this.chunkTimeoutMs&&(this.clearChunkTimeout(),this.chunkTimeoutId=setTimeout(()=>{this.abortController?.abort(new i.MU("Sorry, this is taking longer than usual."))},this.chunkTimeoutMs))}constructor(e,t,r){a(this,"reader",void 0),a(this,"chunkTimeoutId",void 0),a(this,"chunkTimeoutMs",void 0),a(this,"abortController",void 0),this.reader=e,this.abortController=r,this.chunkTimeoutMs=t||5e3}};var l=r(46988),c=r(57516),u=r(51015),d=r(89790),h=r(55310),m=r(61993),p=r(75632);function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let f="github-models-playground";let AzureModelClient=class AzureModelClient{async sendNonStreamingMessage(e,t,r,n,o,i,a){let s=await this.makeRequest(e,t,r,n,o,i,{abortSignal:a,stream:!1});if(!s.ok)throw await this.throwError(s,e);return this.getNonStreamingResponse(s)}async *sendMessage(e,t,r,n,o,i,a){let s=new AbortController,l={abortSignal:s.signal},c=await this.makeRequest(t,r,n,o,i,a,l);if(this.emitChatRequestSent(c,t,!!n.tools),!c.ok)throw await this.throwError(c,t);if(!(0,h.Nf)(t)){let e=await this.getNonStreamingResponse(c);yield e;return}this.emitStreamingStarted(t);let p="",g=c.body?.getReader();if(!g){let e=(0,d.qp)("An error occurred. Please try again.");yield{message:e};return}this.stopStreamingMessages(e),this.messageStreamers[e]=new MessageStreamer(g,this.chunkTimeoutInMs,s);let f=[],_={inputTokens:0,outputTokens:0};for await(let s of this.messageStreamers[e].stream()){if(s.usage&&(_=(0,m.YY)(s)),0===s.choices.length)continue;for(let e of s.choices[0]?.delta?.tool_calls??[]){if(e.function.name){f.push(e);continue}if("index"in e){f[e.index].function.arguments+=e.function.arguments;continue}}if(s.choices[0]?.finish_reason==="tool_calls"){let l=f[s.choices[0]?.index],c="";if(l?.function.name==="search_documents"){let e=JSON.parse(l.function.arguments);r.push((0,d.qp)([{type:"tool_calls",tool_calls:[l]},{type:"text",text:`Searching documents in index for "${e.query}"...`}]));try{c=await (0,u.$X)({query:e.query})}catch(e){c=`Error searching documents: ${e}`}}for await(let s of(r.push((0,d.eb)(c,l.id)),this.sendMessage(e,t,r,n,o,i,a)))yield s}let l=s.choices[0]?.finish_reason==="length";(s.choices[0]?.delta?.content||l)&&(p+=s.choices[0]?.delta?.content,yield{message:(0,d.qp)(p),tokenUsage:_,reachedMaxTokens:l})}return this.emitStreamingCompleted(t),_}async throwError(e,t){switch(e.status){case 413:return new i.eU;case 429:return this.emitRateLimitedEvent(e,t),new i.AC(e.headers.get("retry-after"))}let r="An error occurred while processing your request.";try{let t=await e.json();return new i.XP(t?.error?.message||r)}catch{return new i.XP(r)}}async makeRequest(e,t,r,n,a,s,l){let c=globalThis.crypto?.randomUUID?.()||null,u={"Content-Type":"application/json","x-ms-model-mesh-model-name":e.original_name.toLowerCase(),"x-ms-useragent":f,"x-ms-user-agent":f,Authorization:await o.Ay.getAuthTokenValue()};c&&(u["x-ms-client-request-id"]=c);let d=[];if(n){let t="o1"===e.name?"developer":"system";d.push({role:t,content:n})}for(let e of t.filter(e=>"error"!==e.role).map(e=>Array.isArray(e.message)&&"tool_calls"===e.message[0].type?{role:e.role,content:e.message[1].text,tool_calls:e.message[0].tool_calls}:"tool"===e.role?{role:e.role,content:e.message,tool_call_id:e.tool_call_id}:{role:e.role,content:e.message}))"string"==typeof e.content?""!==e.content.trim()&&d.push(e):d.push(e);let m={...r,messages:d},g="json_schema"===a&&s&&(0,h.SL)(e);g?m.response_format={type:a,json_schema:JSON.parse(s)}:a&&(0,h.PG)(e)&&(m.response_format={type:a}),"DeepSeek-R1"===e.name&&(m.messages=m.messages.map(e=>{if("assistant"!==e.role)return e;if("string"==typeof e.content){let t=RegExp("<think>(.*?)<\\/think>","gs"),r=RegExp("<think>.*$","gs");e.content=e.content.replace(t,"").replace(r,"").trim()}return e})),(0,h.Nf)(e)&&(m.stream=!0),l?.stream!==void 0&&(m.stream=l.stream),(0,h.be)(e)&&m.stream&&(m.stream_options={include_usage:!0});let _=l?.abortSignal;if(!_){let e=new AbortController;setTimeout(()=>e.abort(new i.MU("Sorry, this is taking longer than usual.")),this.timeoutInMs),_=e.signal}return m.model=e.original_name.toLowerCase(),(0,p.G7)("github_models_gateway")&&(m.provider=this.provider,(0,p.G7)("github_models_gateway_parse_params")?m.model=`${e.publisherSlug.toLowerCase()}/${e.original_name.toLowerCase()}`:m.publisher=e.publisher.toLowerCase()),fetch(g?`${this.url}?api-version=2024-08-01-preview`:this.url,{method:"POST",headers:u,body:JSON.stringify(m),signal:_})}async getNonStreamingResponse(e){let{choices:t=[],usage:r={}}=await e.json(),n=t[0]?.message?.content||"";if(""===n&&"length"===t[0].finish_reason)throw new i.Th;return{message:(0,d.qp)(n),tokenUsage:(0,m.Wt)(r)}}emitChatRequestSent(e,t,r){(0,l.BI)(i.$n,{registry:t.registry,model:t.name,publisher:t.publisher,success:e.ok,result_code:e.status,used_rag:r}),e.ok?(0,c.i)({incrementKey:"MODELS_CHAT_REQUEST",requestUrl:window.location.href}):(0,c.i)({incrementKey:"MODELS_CHAT_REQUEST_ERROR",requestUrl:window.location.href})}emitRateLimitedEvent(e,t){(0,l.BI)(i.aT,{registry:t.registry,model:t.name,publisher:t.publisher,rate_limit_type:e.headers.get("X-RateLimit-Type")})}emitStreamingStarted(e){(0,l.BI)(i.g4,{registry:e.registry,model:e.name,publisher:e.publisher})}emitStreamingCompleted(e){(0,l.BI)(i.Mw,{registry:e.registry,model:e.name,publisher:e.publisher})}constructor(e){g(this,"url",void 0),g(this,"timeoutInMs",3e5),g(this,"chunkTimeoutInMs",1e4),g(this,"provider","azureml"),g(this,"messageStreamers",{}),g(this,"stopStreamingMessages",e=>{let t=this.messageStreamers[e];t?.stop()}),g(this,"localStorage",(0,n.A)("localStorage",{throwQuotaErrorsOnSet:!1,ttl:864e5})),this.url=e}}},27691:(e,t,r)=>{r.d(t,{S:()=>i});var n=r(57572),o=r(5796);async function i({model:e,feedback:t}){let r=await (0,n.lS)((0,o.AwS)(e),{method:"POST",body:{feedback:t}});if(r.ok)return r;throw Error("Failed to submit feedback")}},23843:(e,t,r)=>{r.d(t,{Ds:()=>i,YN:()=>s,du:()=>o,sc:()=>a});let n=["Microsoft","OpenAI","Meta"],o=(e,t)=>{let r=t?.capabilities?.chat?.messagesWithImages,n=e.filter(e=>Array.isArray(e.message)&&e.message.filter(e=>"image_url"===e.type)).length;return!!r&&n>=r};function i(e){return n.includes(e.publisher)&&e.supported_input_modalities.includes("image")}let a=e=>i(e),s=e=>"gpt-4o-mini"===e},89790:(e,t,r)=>{r.d(t,{Cz:()=>o,Gy:()=>c,Kh:()=>a,Zx:()=>i,dX:()=>d,eb:()=>h,j$:()=>l,qp:()=>u});var n=r(23843);let o=e=>{if("string"==typeof e)return e;{let t=e.find(e=>"text"===e.type);return t?.text??""}},i=e=>{let t=o(e),r=[];return"object"==typeof e&&(r=e.filter(e=>"image_url"===e.type).map(e=>e.image_url.url)),{text:t,attachments:r}},a=(e,t,r,o,i)=>{let a=e.trim().length>0,s=t.length>0,c=(0,n.Ds)(i)&&!(0,n.du)(r,o),u=(0,n.YN)(i.name);if(a||s&&c&&u){if(s&&c){let{imagesPerTurn:r=1/0}=o?.capabilities?.chat??{imagesPerTurn:1/0},n=t.slice(0,r).map(e=>({type:"image_url",image_url:{url:e}}));return a?l([...n,{type:"text",text:e}]):l(n)}return l(e)}},s=(e,t)=>({timestamp:new Date,role:e,message:t}),l=e=>s("user",e),c=e=>s("error",e),u=e=>s("assistant",e),d=e=>s("system",e),h=(e,t)=>({...s("tool",e),tool_call_id:t})},55310:(e,t,r)=>{r.d(t,{Nf:()=>i,PG:()=>s,SL:()=>l,be:()=>c,fc:()=>a});var n=r(697),o=r(75632);function i(e){return!!("o3-mini"===e.name&&(0,o.G7)("github_models_o3_mini_streaming"))||!n.t$.includes(e.name)}function a(e){return!n.t$.includes(e.name)}function s(e){if(n.t$.includes(e.name))return!1;let t=e.publisher.toLowerCase();return"openai"===t||"mistral ai"===t}function l(e){return"gpt-4o"===e.name.toLowerCase()}function c(e){return"openai"===e.publisher.toLowerCase()}},61993:(e,t,r)=>{r.d(t,{Wt:()=>a,YY:()=>i,mW:()=>o,wd:()=>n});let n=()=>({lastMessageInputTokens:0,totalInputTokens:0,lastMessageOutputTokens:0,totalOutputTokens:0});function o(e,t){return t?{...e,lastMessageInputTokens:t.inputTokens,totalInputTokens:e.totalInputTokens+t.inputTokens,lastMessageOutputTokens:t.outputTokens,totalOutputTokens:e.totalOutputTokens+t.outputTokens}:e}let i=e=>({inputTokens:e.usage?.prompt_tokens||0,outputTokens:e.usage?.completion_tokens||0}),a=({prompt_tokens:e,completion_tokens:t})=>({inputTokens:e||0,outputTokens:t||0})},26522:(e,t,r)=>{r.d(t,{D:()=>i,l:()=>n});let n={Cohere:"cohere",Core42:"core42",DeepSeek:"deepseek",Meta:"meta",Microsoft:"microsoft",Mistral:"mistral",MistralAI:"mistralai",MistralAI2:"mistral ai",OpenAI:"openai",OpenAIEVault:"openaidevault",AI21Labs:"ai21 labs"},o={cohere:"Cohere",core42:"Core42",deepseek:"DeepSeek",meta:"Meta",microsoft:"Microsoft",mistral:"Mistral",mistralai:"Mistral",openai:"Azure OpenAI Service",openaidevault:"OpenAI",ai21labs:"AI21 Labs"};function i(e){return o[e.toLowerCase()]||e}},697:(e,t,r)=>{function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,{$n:()=>i,AC:()=>TooManyRequestsError,Cr:()=>c,DL:()=>k,HL:()=>g,MU:()=>TimeoutError,Mw:()=>l,Ng:()=>h,Pq:()=>b,SN:()=>o,Th:()=>CompletionTokensLimitReachedResponseError,XP:()=>ModelClientError,aQ:()=>_,aT:()=>a,eU:()=>TokenLimitReachedResponseError,g4:()=>s,jB:()=>u,jM:()=>f,mA:()=>p,oq:()=>y,qY:()=>d,t$:()=>v,wG:()=>m});let ModelClientError=class ModelClientError extends Error{constructor(...e){super(...e),n(this,"canRetry",!1),n(this,"tokenLimitReached",!1),this.name="ModelClientError"}};let TimeoutError=class TimeoutError extends ModelClientError{constructor(...e){super(...e),this.name="TimeoutError"}};let o="The conversation token limit has been reached. ";let TokenLimitReachedResponseError=class TokenLimitReachedResponseError extends ModelClientError{constructor(){super(o),this.name="TokenLimitReachedResponseError",this.tokenLimitReached=!0}};let CompletionTokensLimitReachedResponseError=class CompletionTokensLimitReachedResponseError extends ModelClientError{constructor(){super("The completion tokens limit has been reached for this response. Please increase the max completion tokens parameter or try a different prompt."),this.name="CompletionTokensLimitReachedResponseError",this.canRetry=!0}};let TooManyRequestsError=class TooManyRequestsError extends ModelClientError{constructor(e){super(e?`Rate limited, please try again in ${e} seconds.`:"Rate limited, please try again later."),this.canRetry=!0,this.name="TooManyRequestsError"}};let i="github_models.playground.chat_request.sent",a="github_models.playground.chat_request.rate_limited",s="github_models.playground.chat_request.streaming_started",l="github_models.playground.chat_request.streaming_completed",c="github_models.playground.chat_suggestion",u="github_models.getting_started.clicked",d="github_models.run_codespace.clicked",h="github_models.improve_system_prompt.clicked",m="github_models.generate_system_prompt.clicked",p="github_models.use_improved_system_prompt.clicked",g="github_models.cancel_improved_system_prompt.clicked",f="github_models.improve_user_prompt.clicked",_="github_models.generate_user_prompt.clicked",y="github_models.use_improved_user_prompt.clicked",b="github_models.cancel_improved_user_prompt.clicked",k="github/codespaces-models",v=["o1-mini","o1-preview","o1","o3-mini"]},51015:(e,t,r)=>{let n;r.d(t,{$X:()=>f,Dx:()=>l,KQ:()=>d,QM:()=>u,RG:()=>c,V9:()=>_,Yu:()=>m,tD:()=>g,vf:()=>h});var o=r(47802),i=r(13219),a=r(21550);let s="https://models.inference.ai.azure.com";function l(){return n}async function c(){let e=await fetch(`${s}/freeazuresearch/endpoint`,{headers:{Authorization:await o.Ay.getAuthTokenValue(),"Content-Type":"application/file","X-Auth-Provider":"github"}});if(!e.ok)return null;let t=await e.json();return t.indexName?n={name:t.indexName,endpoint:t.endpoint,status:t.indexerLastExecutionResult,files:t.indexStats?.files.map(({name:e,searchDocsCount:t})=>({name:e,size:t}))??[]}:null}async function u(e,t){(await fetch(`${s}/freeazuresearch/files/${e}/${t.name}`,{method:"PUT",headers:{Authorization:await o.Ay.getAuthTokenValue(),"Content-Type":"application/file","X-Auth-Provider":"github"},body:t})).ok}async function d(){let e=await fetch(`${s}/freeazuresearch/files/createUploadSession`,{method:"POST",headers:{Authorization:await o.Ay.getAuthTokenValue(),"Content-Type":"application/json","X-Auth-Provider":"github"}});if(!e.ok)return"";let{id:t}=await e.json();return t}async function h(e){let t=await fetch(`${s}/freeazuresearch/files/${e}/_complete`,{method:"POST",headers:{Authorization:await o.Ay.getAuthTokenValue(),"Content-Type":"application/json","X-Auth-Provider":"github"}});return t.ok?await t.json():{id:"error",indexerName:"error"}}async function m(){(await fetch(`${s}/freeazuresearch/index`,{method:"DELETE",headers:{Authorization:await o.Ay.getAuthTokenValue(),"Content-Type":"application/json","X-Auth-Provider":"github"}})).ok}async function p(){if(!(await fetch(`${s}/freeazuresearch/refreshEmbeddingToken`,{method:"HEAD",headers:{Authorization:await o.Ay.getAuthTokenValue(),"Content-Type":"application/json","X-Auth-Provider":"github"}})).ok)return}let g={type:"function",function:{name:"search_documents",description:"Search documents matching a query given as a series of keywords.",parameters:{type:"object",properties:{query:{type:"string",description:"a series of keywords to use as query to search documents"}},required:["query"]}}};async function f({query:e}){let t;let{endpoint:r,name:s}=n,l=(await o.Ay.getAuthToken()).token;if(!r||!l||!s)throw Error("No index selected");let c=new i._(r,s,new a.K(l)),u=()=>c.search(e,{top:5,queryType:"semantic",select:["chunk_id","title","chunk"],semanticSearchOptions:{},vectorSearchOptions:{queries:[{kind:"text",text:e,kNearestNeighborsCount:50,fields:["text_vector"]}]}});try{t=await u()}catch(e){if(502===e.statusCode){if(!(await o.Ay.getAuthToken()).token)throw Error("Authentication token is required for this action");await p(),t=await u()}else throw e}let d=[],h=await t.results.next();for(;!h.done;){let e=h.value.document;d.push(JSON.stringify({title:e.title,content:e.chunk.replaceAll("\n"," ")})),h=await t.results.next()}return d.join("\n")}let _=`import os
import json

from azure.ai.inference import ChatCompletionsClient
from azure.core.credentials import AzureKeyCredential
from azure.ai.inference.models import *
import requests
from azure.search.documents import SearchClient
from azure.search.documents.models import QueryType, VectorizableTextQuery


# To authenticate with the model you will need to generate a personal access token (PAT) in your GitHub settings.
# Create your PAT token by following instructions here: https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens
GITHUB_TOKEN = os.environ["GITHUB_TOKEN"]
MODELS_ENDPOINT = "{model_endpoint}"

client = ChatCompletionsClient(
    endpoint=MODELS_ENDPOINT,
    credential=AzureKeyCredential(GITHUB_TOKEN),
)

# Get your free RAG endpoint from GitHub Models playground
SEARCH_ENDPOINT = "{search_endpoint}"

search_client = SearchClient(
    endpoint=SEARCH_ENDPOINT,
    index_name="{search_index}",
    credential=AzureKeyCredential(GITHUB_TOKEN),
)


def search_documents(query: str):
    """Search documents matching a query given as a series of keywords."""
    # search for documents that are semantically similar to the query
    r = search_client.search(
        search_text=query,
        vector_queries=[
            VectorizableTextQuery(
                text=query, k_nearest_neighbors=50, fields="text_vector"
            )
        ],
        query_type=QueryType.SEMANTIC,
        top=5,
        select=["chunk_id", "title", "chunk"],
    )

    # create a json structure for the tool output
    results = [f"title:{doc['title']}\\n" + f"content: {doc['chunk']}".replace("\\n", " ") for doc in r]
    # return the json structure as a string
    return json.dumps(results)


search_tool = ChatCompletionsToolDefinition(
    function=FunctionDefinition(
        name=search_documents.__name__,
        description=search_documents.__doc__,
        parameters={
            "type": "object",
            "properties": {
                "query": {
                    "type": "string",
                    "description": "a series of keywords to use as query to search documents",
                }
            },
            "required": ["query"],
        },
    )
)

# start a loop to interact with the model
agent_returned = False
messages = [
    SystemMessage(
        content="""You are an assistant that answers users questions about documents. You are given a tool that can search within those documents. Do that systematically to provid the best answers to the user's questions. If you do not find the information, just say you do not know."""
    ),
    UserMessage(content="Can I claim an ambulance?"),]
print(f"User> {messages[-1].content}")

while not agent_returned:
    # Initialize the chat history with the assistant's welcome message
    response = client.complete(
        messages=messages,
        tools=[search_tool],
        model="{model_name}",
        temperature={temperature},
        max_tokens={max_tokens},
        top_p={top_p},
    )

    # We expect the model to ask for a tool call
    if response.choices[0].finish_reason == CompletionsFinishReason.TOOL_CALLS:
        # Append the model response to the chat history
        messages.append(
            AssistantMessage(tool_calls=response.choices[0].message.tool_calls)
        )

        # There might be multiple tool calls to run in parallel
        if response.choices[0].message.tool_calls:
            for tool_call in response.choices[0].message.tool_calls:
                # We expect the tool to be a function call
                if isinstance(tool_call, ChatCompletionsToolCall):
                    # Parse the function call arguments and call the function
                    function_args = json.loads(
                        tool_call.function.arguments.replace("'", '"')
                    )
                    print(
                        f"System> Calling function \`{tool_call.function.name}\` with arguments {function_args}"
                    )
                    callable_func = locals()[tool_call.function.name]
                    function_return = callable_func(**function_args)
                    print(f"System> Function returned.")

                    # Append the function call result to the chat history
                    messages.append(
                        ToolMessage(tool_call_id=tool_call.id, content=function_return)
                    )
                else:
                    raise ValueError(
                        f"Expected a function call tool, instead got: {tool_call}"
                    )
    else:
        agent_returned = True
        print(f"Assistant> {response.choices[0].message.content}")`},1090:(e,t,r)=>{r.d(t,{A:()=>n});let n=(e,t)=>{let r=new URL(e,window.location.origin),n=new URL(t,window.location.origin);return n.href.includes("#")&&r.host===n.host&&r.pathname===n.pathname&&r.search===n.search}},53949:(e,t,r)=>{r.d(t,{G:()=>n});let n=e=>({})},46928:(e,t,r)=>{r.d(t,{Z:()=>h,o:()=>m});var n=r(96540),o=r(47767),i=r(45588),a=r(84976),s=r(1090),l=r(73081),c=r(58135),u=r(76801),d=r(55048);let h=()=>{let{routes:e}=n.useContext(u.k),t=(0,o.Zp)(),a=(0,d.E)();return n.useCallback((o,u={})=>{let d=(0,i.o1)(o).pathname;if(!(0,i.ue)(e,d)||u.reloadDocument){let e="string"==typeof o?o:(0,i.AO)(o);(async()=>{let{softNavigate:t}=await Promise.all([r.e("vendors-node_modules_github_turbo_dist_turbo_es2017-esm_js"),r.e("ui_packages_soft-navigate_soft-navigate_ts")]).then(r.bind(r,61828));t(e)})()}else{(0,s.A)(location.href,o.toString())||(0,l.SC)("react");let{preventAutofocus:e,...r}=u;(0,n.startTransition)(()=>{if(t(o,e?{...r,state:{[c.V]:!0,...r.state}}:r),!a){let{turbo:e,...t}=window.history.state??{};window.history.replaceState({...t,skipTurbo:!0},"",location.href)}})}},[t,a,e])},m=()=>{let[e]=(0,a.ok)(),t=h(),{pathname:r}=(0,o.zy)(),i=n.useCallback((n,o={})=>{t({pathname:r,search:(0,a.PI)("function"==typeof n?n(e):n).toString()},o)},[e,t,r]);return[e,i]}},80758:(e,t,r)=>{r.d(t,{H:()=>a});var n=r(96540);let o=(e,t,r)=>{let n=t[1]-t[0];return e<t[0]?e:e<t[1]?t[0]+r:e+(r-n)},i=(e,t)=>({...e,nativeEvent:e,target:t,currentTarget:t,preventDefault:()=>e.preventDefault(),isDefaultPrevented:()=>e.defaultPrevented,isPropagationStopped:()=>!1,persist:()=>({})}),a=({inputRef:e,fallbackEventHandler:t})=>(0,n.useCallback)((r,n,a)=>{let s=e.current;if(!s)return;let l=document.activeElement;s.focus();let c=n??[s.selectionStart??s.value.length,s.selectionEnd??s.value.length],u=void 0===a?o(s.selectionStart??s.value.length,c,r.length):Array.isArray(a)?a[0]:a,d=Array.isArray(a)?a[1]:u,h=!1;try{if(document.activeElement!==s)throw Error("Input must be focused to use execCommand");s.setSelectionRange(c[0],c[1]),h=""===r?document.execCommand("delete",!1):document.execCommand("insertText",!1,r),s.setSelectionRange(u,d)}catch{h=!1}if((l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement)&&l.focus(),!h){let n=s.value.slice(0,c[0])+r+s.value.slice(c[1]),o=new InputEvent("input",{bubbles:!1});e.current.value=n,e.current.setSelectionRange(u,d),e.current.dispatchEvent(o),t(i(o,e.current))}},[e,t])},34004:(e,t,r)=>{r.d(t,{J:()=>o});var n=r(38359);let o=()=>{let e=(0,n.X)();return{currentUser:e&&e.current_user?e.current_user:null}}},57572:(e,t,r)=>{function n(e,t={}){!function(e){if(new URL(e,window.location.origin).origin!==window.location.origin)throw Error("Can not make cross-origin requests from verifiedFetch")}(e);let r={...t.headers,"GitHub-Verified-Fetch":"true","X-Requested-With":"XMLHttpRequest"};return fetch(e,{...t,headers:r})}function o(e,t){let r={...t?.headers??{},Accept:"application/json","Content-Type":"application/json"},o=t?.body?JSON.stringify(t.body):void 0;return n(e,{...t,body:o,headers:r})}function i(e,t={}){let r={...t.headers,"GitHub-Is-React":"true"};return n(e,{...t,headers:r})}function a(e,t){let r={...t?.headers??{},"GitHub-Is-React":"true"};return o(e,{...t,headers:r})}r.d(t,{DI:()=>n,QJ:()=>i,Sr:()=>a,lS:()=>o})},26514:(e,t,r)=>{r.d(t,{T:()=>m});var n=r(74848),o=r(45996),i=r(38621),a=r(87330),s=r(96540),l=r(20053),c=r(42522),u=r(13080),d=r(76797);let h={tooltip:"CopyToClipboardButton-module__tooltip--Dq1IB"};function m({icon:e=i.CopyIcon,size:t="medium",onCopy:r,textToCopy:m,tooltipProps:p,variant:g="invisible",ariaLabel:f,className:_,disabled:y,...b}){let[k,v]=s.useState(!1),T=(0,o.A)(),x=f??`Copy "${m}" to clipboard`,w=k?"Copied!":x,A={size:t,variant:g,onClick:()=>{v(!0),(0,u.i)("Copied!"),(0,d.D)(m),r?.(),setTimeout(()=>T()&&v(!1),2e3)},icon:k?i.CheckIcon:e,className:(0,l.$)(k?"color-fg-success":void 0,_),...b},C=(0,s.useId)();return y?(0,n.jsx)(a.K,{...A,"aria-label":x,disabled:!0}):(0,n.jsx)(c.m,{text:w,"aria-label":x,type:"label",id:C,"aria-hidden":!0,...p,className:(0,l.$)(h.tooltip,p?.className),children:(0,n.jsx)(a.K,{...A,"aria-labelledby":C})})}try{m.displayName||(m.displayName="CopyToClipboardButton")}catch{}},17908:(e,t,r)=>{r.d(t,{d:()=>s,t:()=>l});var n=r(74848),o=r(21728),i=r(96540);let a=i.createContext({});function s(e){let t;let r=(0,o.c)(3),{repository:i,children:s}=e;return r[0]!==s||r[1]!==i?(t=(0,n.jsxs)(a.Provider,{value:i,children:[" ",s," "]}),r[0]=s,r[1]=i,r[2]=t):t=r[2],t}function l(){return i.useContext(a)}try{a.displayName||(a.displayName="CurrentRepositoryContext")}catch{}try{s.displayName||(s.displayName="CurrentRepositoryProvider")}catch{}},62456:(e,t,r)=>{r.d(t,{r:()=>s});var n=r(74848),o=r(47584),i=r(47258),a=r(96540);let s=(0,a.forwardRef)(function({src:e,size:t=20,...r},s){let l=(0,a.useMemo)(()=>{let r=new URL(e,o.fV.origin);return r.searchParams.has("size")||r.searchParams.has("s")||r.searchParams.set("size",String(2*Number(t))),r.toString()},[e,t]);return(0,n.jsx)(i.A,{ref:s,src:l,size:t,"data-testid":"github-avatar",...r})});try{s.displayName||(s.displayName="GitHubAvatar")}catch{}},39525:(e,t,r)=>{r.d(t,{a:()=>y});var n=r(74848),o=r(87330),i=r(19797),a=r(73451),s=r(65607),l=r(51856),c=r(55847),u=r(10312),d=r(25511),h=r(96540),m=r(86365),p=r(38621),g=r(27691);let f={feedbackDialog:"FeedbackDialog-module__feedbackDialog--w6R47",feedbackDialogHeader:"FeedbackDialog-module__feedbackDialogHeader--XB8hF",checkboxGroupLabel:"FeedbackDialog-module__checkboxGroupLabel--k4SQB"},_=Object.values(d.G);function y({returnFocusRef:e,isFeedbackDialogOpen:t,setIsFeedbackDialogOpen:r,isNegativePreSelected:y,setIsNegativeFeedbackConfirmed:b,modelName:k}){let{canProvideAdditionalFeedback:v,model:T}=(0,m.B)(),x=(0,h.useMemo)(()=>({satisfaction:d.G.UNKNOWN,reasons:[],feedbackText:"",contactConsent:!1,model:k}),[k]),[w,A]=(0,h.useState)(x),[C,S]=(0,h.useState)(!1),E=w.satisfaction===d.G.UNKNOWN&&0===w.feedbackText.length||C,N=w.satisfaction===d.G.NEGATIVE||y;(0,h.useEffect)(()=>{y&&A({...w,satisfaction:d.G.NEGATIVE})},[]);let I=(0,h.useCallback)(e=>{let{value:t,checked:r}=e.target;r?A({...w,reasons:[...w.reasons,t]}):A({...w,reasons:w.reasons.filter(e=>e!==t)})},[w,A]),j=(0,h.useCallback)(async()=>{S(!0);try{(await (0,g.S)({model:T,feedback:w})).ok&&(A(x),b?.(!0))}catch(e){console.error(e)}r(!1),S(!1)},[w,x,T,r,b]);(0,h.useEffect)(()=>{v||w.satisfaction!==d.G.POSITIVE||j()},[v,w.satisfaction]);let R=(0,h.useCallback)(e=>{let t=function(e){let t=Number(e);if(new Set(_).has(t))return t;throw Error(`Invalid Feedback of "${e}". Valid options are ${JSON.stringify(_)}`)}(e.currentTarget.value);t===d.G.POSITIVE?A({...w,satisfaction:t,reasons:[]}):A({...w,satisfaction:t})},[w]);return(0,n.jsxs)(u.A,{returnFocusRef:e,onDismiss:()=>{r(!1)},isOpen:t,"aria-labelledby":"feedback-header",className:f.feedbackDialog,children:[(0,n.jsx)(u.A.Header,{id:"feedback-header",className:f.feedbackDialogHeader,children:"Provide feedback"}),(0,n.jsxs)("form",{className:"p-3 d-flex flex-column gap-3",children:[!y&&(0,n.jsxs)("div",{className:"d-flex flex-column",children:[(0,n.jsx)("h4",{className:"f5",children:"How has your experience been with GitHub Models?"}),(0,n.jsxs)("div",{className:"d-flex mt-2",children:[(0,n.jsx)(o.K,{className:`color-fg-muted ${w.satisfaction===d.G.POSITIVE?"color-canvas-subtle":"color-canvas-default"}`,icon:p.ThumbsupIcon,variant:"invisible","aria-label":"Positive",value:"1",onClick:R}),(0,n.jsx)(o.K,{className:`color-fg-muted ${w.satisfaction===d.G.POSITIVE?"color-canvas-subtle":"color-canvas-default"}`,icon:p.ThumbsdownIcon,variant:"invisible","aria-label":"Negative",value:"2",onClick:R})]})]}),N&&(0,n.jsxs)(i.A,{children:[(0,n.jsx)(i.A.Label,{className:f.checkboxGroupLabel,children:"This response is..."}),(0,n.jsxs)(a.A,{children:[(0,n.jsx)(s.A,{value:"harmful",onChange:I}),(0,n.jsx)(a.A.Label,{className:"text-normal",children:"Harmful or unsafe"})]}),(0,n.jsxs)(a.A,{children:[(0,n.jsx)(s.A,{value:"not true",onChange:I}),(0,n.jsx)(a.A.Label,{className:"text-normal",children:"Not true"})]}),(0,n.jsxs)(a.A,{children:[(0,n.jsx)(s.A,{value:"unhelpful",onChange:I}),(0,n.jsx)(a.A.Label,{className:"text-normal",children:"Not helpful"})]}),(0,n.jsxs)(a.A,{children:[(0,n.jsx)(s.A,{value:"other",onChange:I}),(0,n.jsx)(a.A.Label,{className:"text-normal",children:"Other"})]})]}),v&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(a.A,{children:[(0,n.jsx)(a.A.Label,{children:"Additional information"}),(0,n.jsx)(l.Ay,{"aria-label":"Additional information",resize:"vertical",rows:3,value:w.feedbackText,placeholder:"Give as much detail and context as possible but do not share any personal or sensitive information.",onChange:e=>{A({...w,feedbackText:e.target.value})},className:"width-full"})]}),(0,n.jsxs)(a.A,{children:[(0,n.jsx)(s.A,{value:"default",checked:w.contactConsent,onChange:()=>{A({...w,contactConsent:!w.contactConsent})}}),(0,n.jsx)(a.A.Label,{className:"text-normal",children:"Allow GitHub to follow up about this feedback using the primary email address on your account."})]})]}),(v||N)&&(0,n.jsx)("div",{className:"d-flex mt-2 flex-justify-end",children:(0,n.jsx)(c.Q,{variant:"primary",onClick:j,disabled:E,children:"Submit feedback"})})]})]})}try{y.displayName||(y.displayName="FeedbackDialog")}catch{}},43923:(e,t,r)=>{r.d(t,{K:()=>a});var n=r(74848),o=r(47258),i=r(53949);function a({logoUrl:e,darkModeIcon:t,publisher:r,square:a=!0,...s}){let l=e;return l&&"AI21 Labs"!==r||(l=t?`data:image/svg+xml;base64,${t}`:""),(0,n.jsx)(o.A,{square:a,alt:`${r} logo`,src:l,...(0,i.G)("publisher-avatar"),...s})}try{a.displayName||(a.displayName="PublisherAvatar")}catch{}},715:(e,t,r)=>{r.d(t,{W:()=>p});var n=r(74848),o=r(73451),i=r(67138),a=r(65607),s=r(89323),l=r(8338),c=r(96540),u=r(51856);function d({name:e,description:t,label:r,onChange:i,value:a}){let s=(0,c.useRef)(null);return(0,n.jsxs)(o.A,{id:e,children:[(0,n.jsx)(o.A.Label,{children:r??e}),t&&(0,n.jsx)(o.A.Caption,{children:t}),(0,n.jsx)(u.Ay,{ref:s,name:e,value:"string"==typeof a?a:a.join("\n"),block:!0,rows:1,resize:"vertical",onChange:i})]})}try{d.displayName||(d.displayName="PlaygroundArrayInput")}catch{}let h={"field-description":"PlaygroundNumericInput-module__field-description--ny0fh","range-input":"PlaygroundNumericInput-module__range-input--WsVA4","number-control":"PlaygroundNumericInput-module__number-control--Ykmoc"};function m({handleInputChange:e,name:t,label:r,description:a,min:s,max:l,onChange:c,value:u}){let d=void 0!==l&&void 0!==s,m=r=>e({key:t,value:r,validate:!0}),p=a?`${t}-description`:void 0;return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"width-full d-flex gap-3 flex-items-end",children:[(0,n.jsxs)(o.A,{className:h["number-control"],id:t,children:[(0,n.jsx)(o.A.Label,{children:r??t}),(0,n.jsx)(i.A,{name:t,type:"number",max:l,min:s,step:1===l?.01:1,value:u,block:!0,onChange:c,onBlur:()=>m(u),"aria-describedby":p})]}),d&&(0,n.jsxs)(o.A,{id:`${t}-range-input`,className:"width-full",children:[(0,n.jsxs)(o.A.Label,{visuallyHidden:!0,children:[r??t," slider"]}),(0,n.jsx)(i.A,{name:`${t}-range-input`,type:"range",value:u,min:s,max:l,step:1===l?.01:1,onChange:({currentTarget:e})=>m(e.value),className:`flex-1 ${h["range-input"]}`})]})]}),a&&(0,n.jsx)("div",{className:h["field-description"],id:p,children:a})]})}try{m.displayName||(m.displayName="PlaygroundNumericInput")}catch{}function p({parameter:{key:e,type:t,friendlyName:r,description:c,required:u,min:h,max:p,options:g},value:f,handleInputChange:_}){let y=({currentTarget:r})=>{let n=r.value;"checkbox"===r.type&&r instanceof HTMLInputElement?n=r.checked:"array"===t&&(n=n.split("\n")),_({key:e,value:n,validate:!1})},b=r||e;return"string"===t?(0,n.jsxs)(o.A,{required:u,id:e,children:[(0,n.jsx)(o.A.Label,{children:b}),c&&(0,n.jsx)(o.A.Caption,{children:c}),(0,n.jsx)(i.A,{type:"text",value:f,block:!0,onChange:y,name:e})]}):"number"===t||"integer"===t?(0,n.jsx)(m,{description:c,name:e,label:b,onChange:y,handleInputChange:_,min:h,max:p,value:f}):"array"===t?(0,n.jsx)(d,{description:c,label:b,name:e,value:f,onChange:y}):"boolean"===t?(0,n.jsxs)(o.A,{id:e,children:[(0,n.jsx)(o.A.Label,{children:b}),c&&(0,n.jsx)(o.A.Caption,{children:c}),(0,n.jsx)(a.A,{name:e,checked:f,onChange:y})]}):"multiple_choice"===t&&Array.isArray(g)?(0,n.jsxs)(o.A,{id:e,children:[(0,n.jsx)(o.A.Label,{children:b}),c&&(0,n.jsx)(o.A.Caption,{children:c}),(0,n.jsxs)(s.W,{children:[(0,n.jsx)(s.W.Button,{name:e,"aria-label":e,children:f||"Select an option"}),(0,n.jsx)(s.W.Overlay,{width:"small",children:(0,n.jsx)(l.l,{selectionVariant:"single",children:g.map(t=>(0,n.jsx)(l.l.Item,{selected:t===f,onSelect:()=>_({key:e,value:t,validate:!1}),children:t},t))})})]})]}):null}try{p.displayName||(p.displayName="PlaygroundInput")}catch{}},70255:(e,t,r)=>{r.d(t,{a:()=>G});var n=r(74848),o=r(70170);let i=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],a=(e,t)=>{let{height:r,top:n,left:o}=function(e,t){let r="mozInnerScreenX"in window,n=document.createElement("div");n.id="input-textarea-caret-position-mirror-div",document.body.appendChild(n);let o=n.style,a=window.getComputedStyle(e),s=isNaN(parseInt(a.lineHeight))?1.2*parseInt(a.fontSize):parseInt(a.lineHeight),l=e instanceof HTMLInputElement;for(let t of(o.whiteSpace=l?"nowrap":"pre-wrap",o.wordWrap=l?"":"break-word",o.position="absolute",i))if(l&&"lineHeight"===t){if("border-box"===a.boxSizing){let e=parseInt(a.height),t=parseInt(a.paddingTop)+parseInt(a.paddingBottom)+parseInt(a.borderTopWidth)+parseInt(a.borderBottomWidth),r=t+s;e>r?o.lineHeight=`${e-t}px`:e===r?o.lineHeight=a.lineHeight:o.lineHeight="0"}else o.lineHeight=a.height}else if(l||"width"!==t||"border-box"!==a.boxSizing)o[t]=a[t];else{let t=parseFloat(a.borderLeftWidth)+parseFloat(a.borderRightWidth),n=r?parseFloat(a.width)-t:e.clientWidth+t;o.width=`${n}px`}r?e.scrollHeight>parseInt(a.height)&&(o.overflowY="scroll"):o.overflow="hidden",n.textContent=e.value.substring(0,t),l&&(n.textContent=n.textContent.replace(/\s/g,"\xa0"));let c=document.createElement("span");c.textContent=l?".":e.value.substring(t)||".",n.appendChild(c);let u={top:c.offsetTop+parseInt(a.borderTopWidth),left:c.offsetLeft+parseInt(a.borderLeftWidth),height:s};return document.body.removeChild(n),u}(e,t);return{height:r,top:n-e.scrollTop,left:o-e.scrollLeft}},s=(e,t)=>{let{top:r,left:n,height:o}=a(e,t),{top:i,left:s}=e.getBoundingClientRect();return{height:o,top:i+r,left:s+n}};var l=r(47584),c=r(80758),u=r(74021),d=r(64515),h=r(16255),m=r(20053),p=r(96540),g=r(35908),f=r(38568);let _=({isOpen:e,listElement:t,inputElement:r,onCommit:n,options:o,tabInsertsSuggestions:i=!1,firstOptionSelectionMode:a="none"})=>{let s=(0,p.useId)(),l=`combobox-${s}__option`,c=(0,p.useRef)(e),[u,d]=(0,p.useState)(null),h=(0,p.useCallback)(()=>[...t?.querySelectorAll("[role=option]")??[]],[t]),m=(0,p.useCallback)(e=>{let t=e.target.getAttribute("data-combobox-list-index"),r=o[null!==t?parseInt(t,10):NaN];r&&n({nativeEvent:e,option:r})},[o,n]),_=(0,p.useCallback)(e=>e.preventDefault(),[]);(0,p.useEffect)(function(){if(r&&t){t.getAttribute("role")||t.setAttribute("role","listbox");let e=new g.A(r,t,{tabInsertsSuggestions:i,firstOptionSelectionMode:a});return d(e),()=>{e.destroy(),d(null)}}},[r,t,i,a]),(0,p.useEffect)(function(){let t=c.current;c.current=e&&null!==u,e!==t&&u&&(e?u.start():u.stop())},[e,u]),(0,p.useEffect)(function(){return t?.addEventListener("combobox-commit",m),()=>t?.removeEventListener("combobox-commit",m)},[m,t]),(0,f.N)(()=>{let e=h();for(let[t,r]of e.entries())(!r.id||r.id.startsWith(l))&&(r.id=`${l}-${t}`),r.setAttribute("data-combobox-list-index",t.toString()),r.addEventListener("mousedown",_);return u?.resetSelection(),()=>{for(let t of e)t.removeEventListener("mousedown",_)}},[h,l,o,u,_])};var y=r(63867),b=r(8338),k=r(45221),v=r(72751);let T={Box_0:"AutocompleteSuggestions-module__Box_0--iBnIs",Overlay_0:"AutocompleteSuggestions-module__Overlay_0--QuLJW",ActionListItem:"AutocompleteSuggestions-module__ActionListItem--jPkc1"},x=new Set([" ","\n"]),w=new Set([".","\n"]),A=(e,t,r)=>{let n=e.sort((e,t)=>t.triggerChar.length-e.triggerChar.length);for(let e=r-1,o="",i=n;e>=0&&i.length>0;e--){let r=t[e]??"";for(let n of(o=r+o,x.has(r)&&(i=i.filter(e=>e.multiWord)),w.has(r)&&(i=i.filter(e=>!e.multiWord)),i.filter(e=>o.startsWith(e.triggerChar)))){let r=t[e-1]??"",a=o[1]??"";if((!r||/[\s([]/.test(r))&&(!a||!/\s/.test(a)))return{trigger:n,query:o.slice(n.triggerChar.length)};i=i.filter(e=>e!==n)}}return null},C=e=>"string"==typeof e?e:e.value,S=e=>"string"==typeof e?e:e.key??e.value,E=(...e)=>t=>{for(let r of[...e].reverse())t.isDefaultPrevented()||r?.(t)},N=()=>(0,n.jsx)("div",{className:T.Box_0,children:(0,n.jsx)(y.A,{size:"small"})}),I=({suggestion:e})=>{let t=C(e),r={id:t,children:t,role:"option",className:T.ActionListItem};return"string"==typeof e?(0,n.jsx)(b.l.Item,{...r}):e.render(r)},j=({suggestions:e,portalName:t,triggerCharCoords:r,onClose:o,onCommit:i,inputRef:a,visible:s,tabInsertsSuggestions:l,defaultPlacement:c,firstOptionSelectionMode:u="active"})=>{let d=(0,p.useRef)(null),[h,m]=(0,p.useState)(null),g=(0,p.useCallback)(({option:e})=>{i(C(e))},[i]);_({isOpen:s&&"loading"!==e,listElement:h,inputElement:a.current,onCommit:g,options:Array.isArray(e)?e:[],tabInsertsSuggestions:l,firstOptionSelectionMode:u});let[f,y]=(0,p.useState)(0);return(0,k.A)(function(){let e=d.current?.offsetHeight??0,t=r.top+r.height,n=t+e>window.innerHeight,o=r.top-e,i=o<0,a={below:n&&!i?o:t,above:i&&!n?t:o}[c];y(Number.isNaN(a)?0:a)},[r.top,r.height,e,s,c]),s?(0,n.jsx)(v.Ay,{onEscape:o,onClickOutside:o,returnFocusRef:a,preventFocusOnOpen:!0,portalContainerName:t,top:f,left:r.left,ref:d,className:T.Overlay_0,children:(0,n.jsx)(b.l,{ref:m,role:"listbox",children:"loading"===e?(0,n.jsx)(N,{}):e?.map(e=>n.jsx(I,{suggestion:e},S(e)))})}):(0,n.jsx)(n.Fragment,{})};j.displayName="SuggestionList";try{N.displayName||(N.displayName="LoadingIndicator")}catch{}try{I.displayName||(I.displayName="SuggestionListItem")}catch{}let R={container:"InlineAutocomplete-module__container--UwGMb",fullWidth:"InlineAutocomplete-module__fullWidth--X6eXo"},L=e=>{try{return e.selectionStart}catch(e){if(e instanceof TypeError)return null;throw e}},O=()=>{},G=({triggers:e,suggestions:t,onShowSuggestions:r,onHideSuggestions:i,onSelectSuggestion:a,style:g,children:f,tabInsertsSuggestions:_=!1,suggestionsPlacement:y="below",firstOptionSelectionMode:b="active",portalName:k,fullWidth:v=!1,...T})=>{let[,x]=(0,p.useState)(0),w=(0,u.Lf)(T),S=(0,p.useRef)(null);(0,d.T)(f.ref??O,S);let N=function(e,t){if(p.Children.only(e),t.current&&!(t.current instanceof HTMLInputElement)&&!(t.current instanceof HTMLTextAreaElement))throw TypeError("AutocompleteTextarea child must be a component that forwards a ref and props to an <input> or <textarea> element.");return e}(f,S),I=(0,c.H)({inputRef:S,fallbackEventHandler:N.props.onChange??O}),G=(0,p.useRef)(null),M=null!==t&&t.length>0;(0,p.useEffect)(()=>{if(M){let e=(0,o.n)(()=>x(e=>e+1),100);return document.addEventListener("scroll",e,{capture:!0}),()=>{document.removeEventListener("scroll",e,{capture:!0})}}},[M]);let P=S.current&&G.current&&M?s(S.current,(L(S.current)??0)-G.current.query.length):{top:0,left:0,height:0},q=(0,p.cloneElement)(N,{...w,onBlur:E(N.props.onBlur,()=>{i()}),onKeyDown:E(N.props.onKeyDown,e=>{M&&("Escape"===e.key||"Tab"===e.key&&!_)&&(i(),e.stopPropagation())}),onChange:E(N.props.onChange,t=>{let n=L(t.currentTarget);if(null===n){i();return}G.current=A(e,t.currentTarget.value,n),G.current?r(G.current):i()}),ref:S}),D=M?"loading"===t?"Loading autocomplete suggestions\u2026":`${t.length} autocomplete ${1===t.length?"suggestion":"suggestions"} available; "${C(t[0])}" is highlighted. Press ${_?"Enter or Tab":"Enter"} to insert.`:"";return(0,n.jsxs)("div",{className:(0,m.$)(R.container,v&&R.fullWidth),style:g,children:[q,l.KJ&&(0,n.jsx)(j,{suggestions:t,inputRef:S,onCommit:e=>{if(!S.current||!G.current)return;let{query:t,trigger:r}=G.current;a?.({suggestion:e,trigger:r,query:t});let n=L(S.current)??0,o=t.length+r.triggerChar.length,s=n-o,l=r.keepTriggerCharOnCommit??!0?r.triggerChar:"",c=r.insertSpaceOnCommit??!0,u=`${l}${e}${c?" ":""}`;i(),I(u,[s,s+o])},onClose:i,triggerCharCoords:P,visible:M,tabInsertsSuggestions:_,defaultPlacement:y,firstOptionSelectionMode:b,portalName:k}),l.KJ&&(0,n.jsx)(h.Z,{children:(0,n.jsx)("span",{"aria-live":"assertive","aria-atomic":!0,style:{clipPath:"circle(0)",position:"absolute"},children:D})})]})};try{G.displayName||(G.displayName="InlineAutocomplete")}catch{}}}]);
//# sourceMappingURL=ui_packages_copilot-chat_utils_copilot-feature-flags_ts-ui_packages_github-models_types_ts-ui-8c3143-866dbdde23a2.js.map